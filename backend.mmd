graph TB
    %% External Interfaces
    A[üåê HTTP Requests] --> B[üöÄ FastAPI Application]
    B --> C[üõ°Ô∏è CORS Middleware]
    
    %% API Endpoints
    C --> D{Endpoint?}
    D -->|/health| E[üíö Health Check]
    D -->|/chat| F[üí¨ Chat Handler]
    D -->|/sessions| G[üìã Session Manager]
    
    %% Core API Layer
    F --> H[üìù Request Validation]
    H --> I[üîç Pydantic Models]
    I --> J[üìä ChatRequest Schema]
    J --> K[üß† Agent Controller]
    
    %% Agent Management
    K --> L{Agent Type?}
    L -->|Smart Agent| M[üéØ SmartTailorTalkAgent]
    L -->|Basic Agent| N[üîÑ LangGraphAgent]
    
    %% Smart Agent Architecture
    M --> O[‚öôÔ∏è Agent Configuration]
    O --> P[üåç Timezone Handler]
    O --> Q[üìö LangChain Executor]
    O --> R[üõ†Ô∏è Tool Registry]
    
    %% Tool System
    R --> S[üè∑Ô∏è @tool Decorators]
    S --> T[‚è∞ Calendar Tools]
    S --> U[üïê Time Tools]
    S --> V[üåê Utility Tools]
    
    %% Calendar Tools Detail
    T --> W[üìä search_available_slots]
    T --> X[üìÖ get_calendar_events]
    T --> Y[üìù book_meeting]
    T --> Z[üîó open_google_calendar]
    T --> AA[‚úÖ verify_meeting_exists]
    
    %% Time & Utility Tools
    U --> BB[üïê get_current_time_info]
    U --> CC[üåç change_timezone]
    V --> DD[üîÑ _parse_smart_date]
    
    %% Calendar Service Layer
    W --> EE[üìã GoogleCalendarService]
    X --> EE
    Y --> EE
    Z --> EE
    AA --> EE
    
    %% Calendar Service Components
    EE --> FF[üîê OAuth2 Handler]
    EE --> GG[üì° Google API Client]
    EE --> HH[‚è∞ Slot Finder Logic]
    EE --> II[üìä Availability Checker]
    
    %% Authentication & Security
    FF --> JJ[üîë credentials.json]
    FF --> KK[üíæ token.pickle]
    FF --> LL[üåê Google OAuth2 Flow]
    
    %% Google Calendar API
    GG --> MM[üìÖ Google Calendar API]
    MM --> NN[üìã Events Endpoint]
    MM --> OO[‚è∞ FreeBusy Endpoint]
    MM --> PP[üìù Insert Endpoint]
    
    %% Data Processing
    HH --> QQ[üîÑ UTC Conversion]
    II --> QQ
    QQ --> RR[üåç Timezone Transformation]
    RR --> SS[üìä Business Hours Filter]
    SS --> TT[üìà Slot Generation]
    
    %% Configuration Management
    O --> UU[‚öôÔ∏è Config Module]
    UU --> VV[üå± Environment Variables]
    VV --> WW[üîê .env File]
    VV --> XX[üè¢ Business Settings]
    
    %% Session & State Management
    K --> YY[üìù Session Storage]
    YY --> ZZ[üíæ In-Memory Store]
    YY --> AAA[üîÑ Conversation History]
    YY --> BBB[üéØ Current Step Tracking]
    
    %% Error Handling & Logging
    M --> CCC[‚ö†Ô∏è Error Handler]
    CCC --> DDD[üìù Logging System]
    CCC --> EEE[üîÑ Retry Logic]
    CCC --> FFF[üí¨ User Feedback]
    
    %% Response Processing
    TT --> GGG[üì§ Response Formatter]
    GGG --> HHH[üïê Timezone Display]
    GGG --> III[üìä JSON Serialization]
    III --> JJJ[üöÄ FastAPI Response]
    
    %% External Dependencies
    LL --> KKK[üåê Google Cloud Console]
    MM --> KKK
    Q --> LLL[ü§ñ OpenAI API]
    P --> MMM[üåç pytz Library]
    
    %% Styling
    classDef apiLayer fill:black
    classDef agentLayer fill:black
    classDef toolLayer fill:black
    classDef calendarLayer fill:black
    classDef configLayer fill:black
    classDef securityLayer fill:black
    classDef externalLayer fill:black
    
    class A,B,C,D,E,F,G,H,I,J,JJJ apiLayer
    class K,L,M,N,O,Q,CCC,DDD,EEE,FFF agentLayer
    class R,S,T,U,V,W,X,Y,Z,AA,BB,CC,DD toolLayer
    class EE,FF,GG,HH,II,MM,NN,OO,PP,QQ,RR,SS,TT calendarLayer
    class UU,VV,WW,XX,YY,ZZ,AAA,BBB,GGG,HHH,III configLayer
    class JJ,KK,LL securityLayer
    class KKK,LLL,MMM externalLayer