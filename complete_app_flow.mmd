graph TB
    %% User Interface Layer
    A[ðŸ‘¤ User Input] --> B[ðŸ–¥ï¸ Streamlit Frontend]
    B --> C{Input Type?}
    
    %% Quick Actions vs Manual Input
    C -->|Quick Action| D[âš¡ Pre-defined Messages]
    C -->|Manual Input| E[âœï¸ Natural Language Text]
    
    %% Frontend Processing
    D --> F[ðŸ“ Format Request]
    E --> F
    F --> G[ðŸŒ Add Timezone Context]
    G --> H[ðŸ“¡ HTTP POST to FastAPI]
    
    %% API Gateway
    H --> I[ðŸš€ FastAPI Backend /chat]
    I --> J[ðŸ” Request Validation]
    J --> K[ðŸ“‹ Session Management]
    K --> L{Session Exists?}
    
    %% Session Handling
    L -->|No| M[ðŸ†• Create New Session]
    L -->|Yes| N[â™»ï¸ Load Session History]
    M --> O[ðŸ§  Initialize Smart Agent]
    N --> O
    
    %% LangChain Agent Processing
    O --> P[ðŸ“š LangChain Agent Executor]
    P --> Q[ðŸŽ¯ Parse User Intent]
    Q --> R{Intent Type?}
    
    %% Different Tool Paths
    R -->|Schedule Meeting| S[â° search_available_slots]
    R -->|View Calendar| T[ðŸ“… get_calendar_events]
    R -->|Open Calendar| U[ðŸ”— open_google_calendar]
    R -->|Book Meeting| V[ðŸ“ book_meeting]
    R -->|Check Time| W[ðŸ• get_current_time_info]
    R -->|Change Timezone| X[ðŸŒ change_timezone]
    
    %% Google Calendar Integration
    S --> Y[ðŸ“Š Google Calendar Service]
    T --> Y
    V --> Y
    Y --> Z[ðŸ” OAuth2 Authentication]
    Z --> AA[ðŸ“‹ Google Calendar API]
    AA --> BB[ðŸ“ˆ Process Calendar Data]
    
    %% Tool Results Processing
    BB --> CC[ðŸ”„ Return Tool Results]
    U --> CC
    W --> CC
    X --> CC
    
    %% Agent Response Generation
    CC --> DD[ðŸ¤– GPT-4 Response Generation]
    DD --> EE[ðŸ“ Format Response with Timezone]
    EE --> FF[ðŸ’¾ Save to Session History]
    FF --> GG[ðŸ“¤ Return API Response]
    
    %% Frontend Display
    GG --> HH[ðŸ–¥ï¸ Streamlit Receives Response]
    HH --> II[ðŸ”„ Update Session State]
    II --> JJ[ðŸ’¬ Display Chat Message]
    JJ --> KK{Response Contains?}
    
    %% Different Display Types
    KK -->|Calendar Slots| LL[â° Display Available Slots]
    KK -->|Calendar Events| MM[ðŸ“… Display Events List]
    KK -->|Calendar Link| NN[ðŸ”— Display Clickable Link]
    KK -->|Error Message| OO[âŒ Display Error Info]
    
    %% User Actions
    LL --> PP[ðŸ‘† User Selects Slot]
    MM --> QQ[ðŸ‘ï¸ User Views Events]
    NN --> RR[ðŸ–±ï¸ User Clicks Link]
    OO --> SS[ðŸ”„ User Retries]
    
    %% Loop Back
    PP --> B
    QQ --> B
    RR --> TT[ðŸŒ Opens Google Calendar]
    SS --> B
    
    %% Styling
    classDef userLayer fill:black
    classDef frontendLayer fill:black
    classDef apiLayer fill:black
    classDef agentLayer fill:black
    classDef toolLayer fill:black
    classDef calendarLayer fill:black
    
    class A,TT userLayer
    class B,C,D,E,F,G,H,HH,II,JJ,KK,LL,MM,NN,OO,PP,QQ,RR,SS frontendLayer
    class I,J,K,L,M,N,GG apiLayer
    class O,P,Q,R,DD,EE,FF agentLayer
    class S,T,U,V,W,X,CC toolLayer
    class Y,Z,AA,BB calendarLayer